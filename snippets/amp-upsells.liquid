<script>

const updateTickerBarFreeShippingMessage = (cart) => {
  const tickerBar = document.querySelector('ticker-bar');
  if (!tickerBar) return;

  const freeShippingEle = tickerBar.querySelector('.free-shipping');
  if (!freeShippingEle) return;

  const freeShippingLimit = parseInt(freeShippingEle.dataset.freeShippingLimit)
  const leftToSpendMessage = freeShippingEle.querySelector('[data-left-to-spend]');

  
  if (freeShippingEle.dataset.freeShipping === 'true') {
    if (!cart || !cart.total_price) {
      freeShippingEle.classList.remove('is-success');
      leftToSpendMessage.innerText = `$${freeShippingLimit}`;
      return;
    }
    
    const subtotal = cart.total_price / 100;
    const leftToSpend = Math.min(freeShippingLimit - subtotal, freeShippingLimit);
    
    if (leftToSpend <= 0) {
      freeShippingEle.classList.add('is-success');
    } else {
      freeShippingEle.classList.remove('is-success');
      leftToSpendMessage.innerText = `$${leftToSpend.toFixed(2).replace('.00', '')}`;
    }
  }
  
};
  
document.addEventListener("click", function (event) {
    event.stopImmediatePropagation(event);
    const button = event.target.closest("form[action='/cart/add'] button.btn--primary, form[action='/cart/add'] button.btn--primary *");
        if (button) {
            console.log("clicked")
            try {
                setTimeout(function () {
                window.AMP_API.OPEN_CART()
                }, 600);

            } catch (err) {
            console.error(err);
            }
        }
    },
    false
);  

window.AMP_CART_UPDATED = function(cart) {
  const cartCountEl = document.querySelector(".header__cart__status");

  if (!cartCountEl) return;

  cartCountEl.setAttribute("data-cart-count", cart.item_count);

  cartCountEl.innerText = cart.item_count;

  if (cart.item_count > 0) {
    cartCountEl.style.display = 'inline-flex';
    cartCountEl.style.justifyContent = 'center';
  } else {
    cartCountEl.style.display = 'none';
  }

  updateTickerBarFreeShippingMessage(cart);
  
};
</script>